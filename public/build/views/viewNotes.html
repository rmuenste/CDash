<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html lang="en" ng-app="CDash">
<head ng-controller="HeadController">
  <meta charset="UTF-8">
  <meta name="robots" content="noindex,nofollow" />
  <link rel="shortcut icon" href="favicon.ico" />
  <link rel="stylesheet" type="text/css" ng-href="{{cssfile}}" />
  <link rel="stylesheet" href="css/bootstrap.min.css"/>
  <script src="js/CDash_2.3.0.min.js"></script>
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

  <style>
  table, th, td {
    border: 1px solid black;
    padding: 4px;
  }

  .result_table {
    background-color: #efefef;
    padding: 3px;
    text-align: center;
    width: 300px;
    margin-left: auto;
    margin-right: auto;
  }
  .mycoolheader {
    background-color: #3652cf;
    color: #ffffff;
    font-weight: bold;
    padding: 3px;
    text-align: center;
    width: 300px;
  }
  .mycoolrow {
    background-color: #ffffff;
  }
  #non_newtonian_fac {
    margin: 25px;
  }

  #curve_chart {
    margin-left: auto;
    margin-right: auto;
  }

  </style>  <title>{{cdash.title || "CDash : View notes"}}</title>

</head>

<body bgcolor="#ffffff" ng-controller="ViewNotesController">
  <div ng-if="cdash.requirelogin == 1" ng-include="'login.php'"></div>

  <ng-include ng-if="cdash.requirelogin != 1" src="cdash.header || 'views/partials/header.html'"></ng-include>

  <div ng-if="cdash.requirelogin != 1 && !cdash.error">
    <br/>

    <table border="0">
      <tr>
        <td align="left">
          <b>Site: </b>
          <a href="viewSite.php?siteid={{cdash.build.siteid}}">{{cdash.build.site}}</a>
        </td>
        <tr>

          <tr>
            <td align="left">
              <b>Build Name: </b>
              <a href="buildSummary.php?buildid={{cdash.build.buildid}}">{{cdash.build.buildname}}</a>
            </td>
          </tr>

          <tr>
            <td align="left">
              <b>Stamp: </b>
              {{cdash.build.stamp}}
            </td>
            <tr>
            </table>

            <br/>
            <a href="" ng-repeat="note in cdash.notes" ng-click="gotoNote($index)">
              <img src="img/document.png" alt="Notes" border="0" align="top"/>
              {{note.time}} -- {{note.name}}
              <br/>
            </a>

            <br/>
            <br/>
            <br/>

            <div ng-repeat="note in cdash.notes">
              <div class="title-divider"  id="note{{$index}}">
                <b>{{note.time}} -- {{note.name}}</b>
              </div>
              <div>
              </div>
              <br/>
              <div id="newtonian_fac">
              </div>
              <div id="non_newtonian_fac">
              </div>
              <div id="visco_fas">
              </div>
              <h2 id="sedimentation_chart" align="center"></h2>
              <div id="curve_chart" style="width: 900px; height: 500px">
              </div>
              <br/>
              <script type="text/javascript">

              function handleSedimentation(testCase) {
                var data;
                var chart;

                var h2 = document.getElementById('sedimentation_chart');
                h2.innerHTML=testCase['Caption'];

                google.charts.load('current', {packages: ['corechart', 'line']});
                google.charts.setOnLoadCallback(drawChart);

                // Callback that creates and populates a data table,
                // instantiates the pie chart, passes in the data and
                // draws it.
                function drawChart() {

                  var mydata = {
                    "cols": [
                      {"label":"Topping","type":"number"},
                      {"label":"Slices" ,"type":"number"}
                    ],
                    "rows": [
                      {"c": [{"v": 0},{"v": 3}]},
                      {"c": [{"v": 1},{"v": 1}]},
                      {"c": [{"v": 2},{"v": 1}]},
                      {"c": [{"v": 3},{"v": 1}]},
                      {"c": [{"v": 4},{"v": 2}]}
                    ]
                  };

                  var data = new google.visualization.DataTable(testCase.data);

                  var options = {
                    title : 'Sedimentation Velocity',
                    hAxis: {
                      title: 'Time[s]'
                    },
                    vAxis: {
                      title: 'U_z'
                    }
                  };

                  var chart = new google.visualization.LineChart(
                    document.getElementById('curve_chart'));
                    chart.draw(data, options);

                  }
                }

                function handleFAC_newtonian(testCase) {
                  var div = document.getElementById('newtonian_fac');
                  var tbl = document.createElement('table');

                  var h2  = document.createElement('h2');
                  var h2Text = document.createTextNode(testCase['Caption']);
                  h2.setAttribute("align","center");
                  h2.appendChild(h2Text);
                  div.appendChild(h2);

                  var cap = tbl.createCaption();
                  cap.innerHTML = testCase['Caption'];

                  tbl.className = "result_table";

                  var t0 = tbl.insertRow();
                  t0.className = "mycoolheader";

                  var tdL = t0.insertCell();
                  tdL.appendChild(document.createTextNode('Level'));

                  var td0 = t0.insertCell();
                  td0.appendChild(document.createTextNode('Drag'));

                  var td1 = t0.insertCell();
                  td1.appendChild(document.createTextNode('Lift'));

                  var t1 = tbl.insertRow();
                  t1.className = "mycoolrow";

                  var td1L = t1.insertCell();
                  td1L.appendChild(document.createTextNode('1'));

                  var td10 = t1.insertCell();
                  td10.appendChild(document.createTextNode(testCase['Drag']));

                  var td11 = t1.insertCell();
                  td11.appendChild(document.createTextNode(testCase['Lift']));

                  div.appendChild(tbl);
                }

                function handleFAC_non_newtonian(testCase) {
                  var div = document.getElementById('non_newtonian_fac');
                  var tbl = document.createElement('table');

                  var h2  = document.createElement('h2');
                  var h2Text = document.createTextNode(testCase['Caption']);
                  h2.setAttribute("align","center");
                  h2.appendChild(h2Text);
                  div.appendChild(h2);

                  var cap = tbl.createCaption();
                  cap.innerHTML = testCase['Caption'];

                  tbl.className = "result_table";

                  var t0 = tbl.insertRow();
                  t0.className = "mycoolheader";

                  var tdL = t0.insertCell();
                  tdL.appendChild(document.createTextNode('Level'));

                  var td0 = t0.insertCell();
                  td0.appendChild(document.createTextNode('Drag'));

                  var td1 = t0.insertCell();
                  td1.appendChild(document.createTextNode('Lift'));

                  var t1 = tbl.insertRow();
                  t1.className = "mycoolrow";

                  var td1L = t1.insertCell();
                  td1L.appendChild(document.createTextNode('1'));

                  var td10 = t1.insertCell();
                  td10.appendChild(document.createTextNode(testCase['Drag']));

                  var td11 = t1.insertCell();
                  td11.appendChild(document.createTextNode(testCase['Lift']));

                  div.appendChild(tbl);
                }

                function handleFAS_visco(testCase) {
                  var div = document.getElementById('visco_fas');
                  var tbl = document.createElement('table');

                  var h2  = document.createElement('h2');
                  var h2Text = document.createTextNode(testCase['Caption']);
                  h2.setAttribute("align","center");
                  h2.appendChild(h2Text);
                  div.appendChild(h2);

                  var cap = tbl.createCaption();
                  cap.innerHTML = testCase['Caption'];

                  tbl.className = "result_table";

                  var t0 = tbl.insertRow();
                  t0.className = "mycoolheader";

                  var tdL = t0.insertCell();
                  tdL.appendChild(document.createTextNode('Level'));

                  var td0 = t0.insertCell();
                  td0.appendChild(document.createTextNode('Drag'));

                  var td1 = t0.insertCell();
                  td1.appendChild(document.createTextNode('Lift'));

                  var t1 = tbl.insertRow();
                  t1.className = "mycoolrow";

                  var td1L = t1.insertCell();
                  td1L.appendChild(document.createTextNode('1'));

                  var td10 = t1.insertCell();
                  td10.appendChild(document.createTextNode(testCase['Drag']));

                  var td11 = t1.insertCell();
                  td11.appendChild(document.createTextNode(testCase['Lift']));

                  div.appendChild(tbl);
                }

                var dom_el = document.querySelector('[ng-controller="ViewNotesController"]');
                console.log(dom_el);
                console.log('I got the controller');
                var ng_el  = angular.element(dom_el);
                console.log(ng_el);
                var ng_el_scope = ng_el.scope();
                console.log('Scope:');
                if(ng_el_scope !== undefined) {
                  var my_text = ng_el_scope.cdash.notes[0].text;
                  try {
                    var my_obj = JSON.parse(my_text);
                  }
                  catch(err) {
                    console.log(err.message);
                    throw new Error('Malformed JSON');
                  }

                  for(i = 0; i < my_obj.length; i++) {
                    if(my_obj[i]['ID']==='NEWTFAC') {
                      handleFAC_newtonian(my_obj[i]);
                    }
                    else if (my_obj[i]['ID']==='NON-NEWTFAC') {
                      handleFAC_non_newtonian(my_obj[i]);
                    }
                    else if (my_obj[i]['ID']==='BENCHSED') {
                      handleSedimentation(my_obj[i]);
                    }
                    else if (my_obj[i]['ID']==='VISCO-FAS') {
                      handleFAS_visco(my_obj[i]);
                    }
                  }

                }
                </script>

              </div>

              <br/>

            </div>

            <!-- FOOTER -->
            <ng-include ng-if="cdash.requirelogin != 1" src="cdash.footer || 'views/partials/footer.html'"></ng-include>
          </body>
          </html>
